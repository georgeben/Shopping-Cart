<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">    
</head>
<body>
    <div id='app'>
        <h1>Vue shopping cart</h1>
        <p>{{product_id}}</p>

        <div class="form-group" style="margin-top: 40px">
            <label for="exampleInputEmail1">Product Id</label>
            <input type="text" class="form-control" placeholder="Enter Product Id" v-model="product_id" >
        </div>

        <div class="form-group">
            <label for="exampleInputPassword1">Product Description</label>
            <input type="text" class="form-control" placeholder="Product Description" v-model="product_desc">
        </div>

        <div class="form-group">
            <label for="exampleInputPassword1">Quantity</label>
            <input type="number" class="form-control" placeholder="Enter product Quantity" v-model="product_qty">
        </div>


        <div class="form-group">
            <label for="exampleInputPassword1">Price</label>
            <input type="number" class="form-control" placeholder="Enter Product Price" v-model="product_price">
        </div>

        <button style="margin-top: 15px" type="submit" class="btn btn-primary" v-on:click = "add_product" >Add Product</button><br />

        <div>
            <table>
                <h4 class="table-titles">Available Products</h4>
                <thead>
                    <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Description</th>
                    <th scope="col">Quantitiy</th>
                    <th scope="col">Price</th>
                    <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <product-item v-for="product in product_list"
                                  v-bind:product = "product"
                                  v-bind:key = "product.id"></product-item>
                </tbody>
            </table>
        </div>

        <div>
            <table>
                <h4 class="table-titles">Shopping Cart</h4>
                <thead>
                    <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Description</th>
                    <th scope="col">Quantitiy</th>
                    <th scope="col">Price</th>
                    <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <selected-item v-for="product in shopping_cart"
                                    v-bind:product = "product"
                                    v-bind:key = "product.id"></selected-item>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        class Product {
            constructor(id, desc, quantity, price) {
                this.id = id;
                this.desc = desc;
                this.price = price;
                this.quantity = quantity;
            }
        }

        Vue.component('selected-item', {
            props: ['product'],
            template: `<tr>
                            <td>{{product.id}}</td>
                            <td>{{product.desc}}</td> 
                            <td>{{product.quantity}}</td>
                            <td>{{product.price}}</td>
                            <td>
                                <button v-on:click="remove_product">REMOVE</button>
                            </td>
                        </tr>`,
            methods: {
                remove_product: function(){
                    let product_index = app.shopping_cart.indexOf(this.product);
                    console.log('About to remove '+ product_index);
                    app.shopping_cart.splice(product_index, 1);
                },
            }
        })

        Vue.component('product-item', {
            props: ['product'],
            template:   `<tr>
                            <td>{{product.id}}</td>
                            <td>{{product.desc}}</td> 
                            <td>{{product.quantity}}</td>
                            <td>{{product.price}}</td>
                            <td>
                                <button v-on:click="add_to_cart">ADD TO CART</button>
                                <button v-on:click="remove_product">REMOVE</button>
                            </td>
                        </tr>`,
            methods: {
                add_to_cart: function(){
                    console.log('Adding to cart', this.product.desc);
                    app.shopping_cart.push(new Product(
                        this.product.id,
                        this.product.desc,
                        this.product.quantity,
                        this.product.price
                    ))
                },
                remove_product: function(){
                    console.log('Removing from product list')
                    let product_index = app.shopping_cart.indexOf(this.product);
                    console.log('About to remove '+ product_index);
                    app.product_list.splice(product_index, 1);
                }
            }
        })

        var app = new Vue({
            el: '#app',
            data: {
                message: 'Hello world!',
                product_id: '',
                product_desc: '',
                product_qty: '',
                product_price: '',
                product_list: [],
                shopping_cart: [],
            },
            methods: {
                add_product: function(event){
                    console.log('Add button clicked');
                    this.product_list.push(new Product(this.product_id,
                                                        this.product_desc,
                                                        this.product_qty,
                                                        this.product_price));
                },
            }
        })
    </script>
</body>
</html>